{"creationTimeStamp":"2022-10-22T13:29:30.357Z","modifiedTimeStamp":"2022-10-23T15:04:55.352Z","createdBy":"Alfredo.Iglesias.Rey@sas.com","modifiedBy":"Alfredo.Iglesias.Rey@sas.com","name":"MSFT Power Integration - Get Data.step","displayName":"MSFT Power Integration - Get Data.step","localDisplayName":"MSFT Power Integration - Get Data.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","uri":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","uri":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","uri":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","uri":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","uri":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","uri":"/dataFlows/steps/afd5799f-6bf5-4c46-a261-286d2443ae65","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"authtokentable","displayName":"authtokentable","localDisplayName":"authtokentable","minEntries":1,"maxEntries":1,"type":"table"},{"name":"definitionsTable","displayName":"definitionsTable","localDisplayName":"definitionsTable","minEntries":1,"maxEntries":1,"type":"table"},{"name":"entDefTable","displayName":"entDefTable","localDisplayName":"entDefTable","minEntries":1,"maxEntries":1,"type":"table"}],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Properties\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"powerPlatformEnvironmentUrl\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the URL for your MSFT Power Platform application\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"mapsFolder\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the folder for maps\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"authtokentable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Authentication Token Table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"dataLib\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the library for data\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"definitionsTable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Metadata Definitions Table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"entDefTable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Entity Definitions Table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page2\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Entities\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"columnselector1\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Column selector label 1\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"c\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": false,\n\t\t\t\t\t\"table\": \"definitionsTable\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"entitiesList\",\n\t\t\t\t\t\"type\": \"list\",\n\t\t\t\t\t\"label\": \"Entities to download (no selection=All)\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"ref\": \"columnselector1\"\n\t\t\t\t\t},\n\t\t\t\t\t\"max\": null,\n\t\t\t\t\t\"min\": 0,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"powerPlatformEnvironmentUrl\": \"\",\n\t\t\"mapsFolder\": \"&_USERHOME./maps\",\n\t\t\"authtokentable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"dataLib\": \"data\",\n\t\t\"definitionsTable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"entDefTable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"columnselector1\": [\n\t\t\t{\n\t\t\t\t\"value\": \"entityName\"\n\t\t\t}\n\t\t],\n\t\t\"entitiesList\": []\n\t}\n}","templates":{"SAS":"/* SAS templated code goes here */\n%macro checkInitialization();\n%if (not %symexist(MSFPowerIntegrationInitialized)) %then %do;\n\t%put NOTE: The MSFT Power Integration has not been initialized;\n\t%abort cancel;\n%end;\n%mend;\n\n%checkInitialization();\n\n\n\nproc sql noprint;\n\tselect authToken into: authtoken from &authTokenTable;\nquit;\n\n%let apiCall=&powerPlatformEnvironmentUrl./api/data/v9.2;\n\n\n%macro createEntities() ;\nproc sql;\n\tcreate table entities as \n\tselect a.EntityName, a.sourceName, a.tableName, b.entitysetname as url \n\tfrom &definitionsTable a, &entDefTable b\n\twhere a.sourceName = b.logicalName;\nquit;\n\n%if (&entitiesList_Count ne 0) %then %do;\n\tdata entities;\n\t\tset entities;\n\t%do i=1 %to &entitiesList_Count;\n\t\tif EntityName eq \"&&EntitiesList_&i\" then output;\n\t%end;\n\trun;\n%end;\n%mend;\n%createEntities();\n\n\n%let sasworkFolder=%sysfunc(pathname(work));\n%let jsonFolder=&sasworkFolder./json;\noptions dlcreatedir;\nlibname json \"&jsonFolder.\";\nlibname json clear;\n\n\nfilename odatamap temp;\n\ndata _null_;\n\tinfile datalines truncover;\n\tlength line $ 100;\n\tfile odatamap;\n\tinput line $100.;\n\tput line;\n\tdatalines;\n{\n  \"DATASETS\": [\n    {\n      \"DSNAME\": \"odata\",\n      \"TABLEPATH\": \"/root\",\n      \"VARIABLES\": [\n        {\n          \"NAME\": \"ordinal_root\",\n          \"TYPE\": \"ORDINAL\",\n          \"PATH\": \"/root\"\n        },\n        {\n          \"NAME\": \"context\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/@odata.context\",\n          \"CURRENT_LENGTH\": 2048\n        },\n        {\n          \"NAME\": \"nextLink\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/@odata.nextLink\",\n          \"CURRENT_LENGTH\": 4096\n        }\n      ]\n    }\n  ]\n}\n;\nrun;\n\n\n%downloadAllEntities(entities,&jsonFolder,odatamap);\n\n%convertAllODataToSASDataset(&jsonFolder,entities,&dataLib,&mapsFolder);\n\nfilename odatamap clear;\nproc datasets lib=work nolist;\n  delete entities;\nrun;\n\n\n\n\n\n\n\n"}}