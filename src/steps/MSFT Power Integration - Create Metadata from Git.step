{"creationTimeStamp":"2022-10-22T11:55:27.223Z","modifiedTimeStamp":"2022-10-23T11:39:45.353Z","createdBy":"Alfredo.Iglesias.Rey@sas.com","modifiedBy":"Alfredo.Iglesias.Rey@sas.com","name":"MSFT Power Integration - Create Metadata from Git.step","displayName":"MSFT Power Integration - Create Metadata from Git.step","localDisplayName":"MSFT Power Integration - Create Metadata from Git.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","uri":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","uri":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","uri":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","uri":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","uri":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","uri":"/dataFlows/steps/0d6cc845-ac87-4519-bd51-e9781422819f","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[{"name":"definitionstable","displayName":"definitionstable","localDisplayName":"definitionstable","minEntries":1,"maxEntries":1,"type":"table","requiresStructure":false},{"name":"memberstable","displayName":"memberstable","localDisplayName":"memberstable","minEntries":1,"maxEntries":1,"type":"table","requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Properties\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"gitUrl\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the URL of the Git repository\",\n\t\t\t\t\t\"placeholder\": \"URl of the Git repository\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"folder\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Select the folder containing the schemas\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"core/applicationCommon\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"FinancialServices\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"Healthcare\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"Marketing\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"Sustainability\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"mapsFolder\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the folder for maps\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"definitionstable\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table label 1\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"memberstable\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table label 2\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"gitUrl\": \"https://github.com/microsoft/CDM\",\n\t\t\"folder\": null,\n\t\t\"mapsFolder\": \"&_USERHOME./maps\",\n\t\t\"definitionstable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"memberstable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t}\n}","templates":{"SAS":"/* SAS templated code goes here */\n\n%macro checkInitialization();\n%if (not %symexist(MSFPowerIntegrationInitialized)) %then %do;\n\t%put NOTE: The MSFT Power Integration has not been initialized;\n\t%abort cancel;\n%end;\n%mend;\n\n%checkInitialization();\n\n\n\n/*create a temporary folder to clone the git repository */ \n%let sasworkFolder=%sysfunc(pathname(work));\n%let gitFolder=&sasworkFolder./git;\noptions dlcreatedir;\nlibname git \"&gitFolder.\";\nlibname git clear;\n\n/* Check if the git folder is empty. Only if it is empty we clone the repository */\n%sys_ls_dir(&gitFolder);\n\nproc sql;\n\tselect count(*) into: filesInGit from WORK._LS_DIR_OUTPUT_;\nquit;\n\n%if (&filesInGit eq 0) %then %do;\n/*clone the git repository */\n\tdata _null_;\n    \trc = git_clone (\"&gitUrl\",\"&gitFolder\");\n    \tput rc=;\n\trun;\n%end;\n\n/* Convert all the json files with the different schemas into one single json file */\n%let schemasDir=&gitFolder./schemaDocuments/&folder;\n%let allTablesFile=&sasworkFolder./allTables.json;\n%joinAllJsons(&schemasDir, &allTablesFile,tables);\n\n/* Create the outputs tables containing definitions and members into the two output tables */\nfilename tblsmap temp;\nfilename tblsjson \"&allTablesFile\";\n\ndata _null_;\n\tinfile datalines truncover;\n\tlength line $ 200;\n\tfile tblsmap;\n\tinput line $200.;\n\tput line;\n\tdatalines;\n{\n  \"DATASETS\": [\n    {\n      \"DSNAME\": \"definitions\",\n      \"TABLEPATH\": \"/root/tables/definitions\",\n      \"VARIABLES\": [\n        {\n          \"NAME\": \"id\",\n          \"TYPE\": \"ORDINAL\",\n          \"PATH\": \"/root/tables/definitions\"\n        },\n        {\n          \"NAME\": \"entityName\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/entityName\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"extendsEntity\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/extendsEntity\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"displayName\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/displayName\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"description\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/description\",\n          \"CURRENT_LENGTH\": 512\n        },\n        {\n          \"NAME\": \"sourceName\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/sourceName\",\n          \"CURRENT_LENGTH\": 50\n        }\n      ]\n    },\n    {\n      \"DSNAME\": \"members\",\n      \"TABLEPATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members\",\n      \"VARIABLES\": [\n        {\n          \"NAME\": \"id\",\n          \"TYPE\": \"ORDINAL\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members\"\n        },\n        {\n          \"NAME\": \"definitionId\",\n          \"TYPE\": \"ORDINAL\",\n          \"PATH\": \"/root/tables/definitions\" \n        },\n        {\n          \"NAME\": \"name\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/name\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"sourceName\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/sourceName\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"sourceOrdering\",\n          \"TYPE\": \"NUMERIC\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/sourceOrdering\"\n        },\n        {\n          \"NAME\": \"description\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/description\",\n          \"CURRENT_LENGTH\": 512\n        },\n        {\n          \"NAME\": \"displayName\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/displayName\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"isNullable\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/isNullable\",\n          \"CURRENT_LENGTH\": 5\n        },\n        {\n          \"NAME\": \"purpose\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/purpose\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"dataType\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/dataType\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"dataTypeReference\",\n          \"TYPE\": \"CHARACTER\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/dataType/dataTypeReference\",\n          \"CURRENT_LENGTH\": 50\n        },\n        {\n          \"NAME\": \"maximumValue\",\n          \"TYPE\": \"NUMERIC\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/maximumValue\"\n        },\n        {\n          \"NAME\": \"minimumValue\",\n          \"TYPE\": \"NUMERIC\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/minimumValue\"\n        },\n        {\n          \"NAME\": \"maximumLength\",\n          \"TYPE\": \"NUMERIC\",\n          \"PATH\": \"/root/tables/definitions/hasAttributes/attributeGroupReference/members/maximumLength\"\n        }\n\n\n\n      ]\n    }\n\n\n\n  ]\n}\n;\nrun;\n\nlibname tables JSON fileref=tblsjson map=tblsmap NO_REOPEN_MSG;\n\ndata &definitionsTable;\n\tset tables.definitions;\n\tlength tableName $30;\n\tif (index(sourceName,\"msdyn_\") eq 1) then \n\t\ttableName=substr(SourceName,7);\n\telse\n\t\ttableName=SourceName;\nrun;\n\t\ndata &membersTable;\n\tset tables.members;\n\tlength columnName $30;\n\tif (index(sourceName,\"msdyn_\") eq 1) then \n\t\tcolumnName=substr(SourceName,7);\n\telse\n\t\tcolumnName=SourceName;\nrun;\nfilename tblsmap clear;\nfilename tblsjson clear;\n\n\n\n"}}