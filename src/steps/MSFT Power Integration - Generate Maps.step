{"creationTimeStamp":"2022-10-23T11:31:50.979Z","modifiedTimeStamp":"2022-10-23T14:54:52.455Z","createdBy":"Alfredo.Iglesias.Rey@sas.com","modifiedBy":"Alfredo.Iglesias.Rey@sas.com","name":"MSFT Power Integration - Generate Maps.step","displayName":"MSFT Power Integration - Generate Maps.step","localDisplayName":"MSFT Power Integration - Generate Maps.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","uri":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","uri":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","uri":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","uri":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","uri":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","uri":"/dataFlows/steps/eb8be365-7303-4306-9d05-ea9f8e31b866","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"definitionsTable","displayName":"definitionsTable","localDisplayName":"definitionsTable","minEntries":1,"maxEntries":1,"type":"table"},{"name":"MembersTable","displayName":"MembersTable","localDisplayName":"MembersTable","minEntries":1,"maxEntries":1,"type":"table"},{"name":"reldefTable","displayName":"reldefTable","localDisplayName":"reldefTable","minEntries":1,"maxEntries":1,"type":"table"}],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Properties\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"mapsFolder\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the folder for maps\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"includeRelationships\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Include Relationships\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"definitionsTable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Definitions Table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"MembersTable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Members Table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"reldefTable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Relationship Definitions Table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"mapsFolder\": \"&_USERHOME./maps\",\n\t\t\"includeRelationships\": false,\n\t\t\"definitionsTable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"MembersTable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"reldefTable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t}\n}","templates":{"SAS":"/* SAS templated code goes here */\n\n%macro checkInitialization();\n%if (not %symexist(MSFPowerIntegrationInitialized)) %then %do;\n\t%put NOTE: The MSFT Power Integration has not been initialized;\n\t%abort cancel;\n%end;\n%mend;\n\n%checkInitialization();\n\n%if &includeRelationships eq 1 %then %do;\n\n\tproc sql;\n\t\tcreate table _relations as\n\t\tselect a.referencingEntity, a.referencingAttribute, a.referencedEntity, a.referencedAttribute,\n\t\tb.Id as definitionId,\n\t\tcat( \"_\", trim(ReferencingAttribute), \"_value\") as AssociationAttribute \n\t\tfrom  &reldefTable.  a, &definitionsTable. b\n\t\twhere a.referencingEntity = b.sourceName\n\t\tand referencedEntity in  (select sourceName from metadata.definitions) \n\t\tand referencingEntity ne ''\n\t\torder by referencingEntity;\n\tquit;\n\n\tdata _newmembers;\n\t\tlength Id definitionId sourceOrdering 8 dataType $ 8 columnName $ 30 sourceName $ 45;\n\t\tkeep Id definitionId sourceOrdering dataType columnName sourceName;\n\t\tset _relations;\n\t\tid=100000+ _N_;\n\t\tsourceOrdering=100000+ _N_;\n\t\tdataType=\"entityId\";\n\t\tsourceName=AssociationAttribute;\n\t\tcolumnName=\"_\" || ReferencingAttribute;\n\trun;\t\n\tdata  _allmembers;\n\t\tset &membersTable;\n\tproc append data=_newmembers base=_allMembers force nowarn;\n\trun;\n\n\t%generateMapFiles(&definitionsTable, _allmembers, &mapsFolder);\n\tproc datasets lib=work nolist;\n\t\tdelete _newmembers _allMembers _relations;\n\trun;\n\n%end;\n\n%else %do;\n\t%generateMapFiles(&definitionsTable, &membersTable, &mapsFolder);\n%end;\n\n"}}